set shell := ["bash", "-lc"]

port := "4010"

setup:
	set -e
	npm install

dev:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	PORT={{port}} npm run dev

test:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	npm run test

lint:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	npm run lint

fmt:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	npm run fmt

typecheck:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	npm run typecheck

build:
	set -e
	if [ ! -d "node_modules" ]; then just setup; fi
	npm run build

container-test:
	@echo "==> Container test: snapshot-service uses Home Assistant's container build system"
	@echo "==> Verifying add-on build completes successfully..."
	if [ ! -x "../talos/build/bin/talos" ]; then ../talos/build.sh; fi
	../talos/build/bin/talos addon build snapshot-service
	@echo "==> Add-on build test passed - ready for deployment"
