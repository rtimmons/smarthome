nvm_use := "export NVM_DIR=\"$HOME/.nvm\"; NVM_VERSION_FILE=\"${NVM_VERSION_FILE:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)/.nvmrc}\"; if [ ! -f \"$NVM_VERSION_FILE\" ]; then echo \"Missing $NVM_VERSION_FILE; cannot select Node runtime.\" >&2; exit 1; fi; ensure_nvm() { if command -v nvm >/dev/null 2>&1 || [ -s \"$NVM_DIR/nvm.sh\" ] || [ -s \"/opt/homebrew/opt/nvm/nvm.sh\" ] || [ -s \"/usr/local/opt/nvm/nvm.sh\" ]; then return; fi; if command -v brew >/dev/null 2>&1; then echo \"Installing nvm via Homebrew (one-time)...\" >&2; HOMEBREW_NO_AUTO_UPDATE=1 brew install nvm || { echo \"Homebrew could not install nvm; install it manually.\" >&2; exit 1; }; mkdir -p \"$NVM_DIR\"; return; fi; echo \"nvm not installed; install via https://github.com/nvm-sh/nvm\" >&2; exit 1; }; load_nvm() { if [ -s \"$NVM_DIR/nvm.sh\" ]; then . \"$NVM_DIR/nvm.sh\"; elif [ -s \"/opt/homebrew/opt/nvm/nvm.sh\" ]; then . \"/opt/homebrew/opt/nvm/nvm.sh\"; elif [ -s \"/usr/local/opt/nvm/nvm.sh\" ]; then . \"/usr/local/opt/nvm/nvm.sh\"; else return 1; fi; }; ensure_nvm; if ! load_nvm; then echo \"nvm not installed; see docs/setup.md\" >&2; exit 1; fi; required=$(tr -d '[:space:]' < \"$NVM_VERSION_FILE\"); if [ \"$(nvm version \"$required\" 2>/dev/null || echo N/A)\" = \"N/A\" ]; then echo \"Installing Node $required via nvm (one-time)...\" >&2; nvm install \"$required\" || { echo \"Failed to install Node $required\" >&2; exit 1; }; fi; nvm use --silent \"$required\" >/dev/null || { echo \"nvm use failed; ensure $required is installed\" >&2; exit 1; }"
