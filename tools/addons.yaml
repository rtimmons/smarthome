addons:
  sonos-api:
    slug: sonos_api
    name: Sonos API
    description: Proxy API for node-sonos-http-api with custom routes and helpers.
    url: https://github.com/rtimmons/smarthome
    source_dir: sonos-api
    copy:
      - src
      - package.json
      - package-lock.json
      - tsconfig.json
    container_workdir: /opt/sonos-api/app
    npm_build: true
    homeassistant_min: "2024.6.0"
    ingress: false
    homeassistant_api: false
    auth_api: false
    host_network: false
    ports:
      "5006": 5006
    ports_description:
      "5006": Sonos API HTTP port
    environment:
      NODE_OPTIONS: "--enable-source-maps"
    options:
      sonos_base_url: "http://local-node-sonos-http-api:5005"
    schema:
      sonos_base_url: "str?"
    translations:
      configuration:
        sonos_base_url:
          name: Sonos API base URL
          description: Base URL for node-sonos-http-api (e.g., http://node-sonos-http-api:5005).
    docs:
      readme: >
        Local add-on that provides a proxy API for node-sonos-http-api with custom routes and helper endpoints
        for controlling Sonos speakers.
      docs: >
        This add-on provides a proxy API for node-sonos-http-api with custom routes and helper endpoints
        tailored for controlling Sonos speakers in your smart home setup.
      access: >
        Access the API at http://<ha-host>:5006/ or use it from other add-ons via http://sonos-api:5006/.
      dependencies:
        - "Requires the Node Sonos HTTP API add-on to be installed and running first."
    run_env:
      - env: PORT
        value: "5006"
      - env: APP_PORT
        value: "5006"
      - env: SONOS_BASE_URL
        from_option: sonos_base_url
        default: "http://local-node-sonos-http-api:5005"
    tests:
      - npm run build

  grid-dashboard:
    slug: grid_dashboard
    name: Grid Dashboard
    description: Dashboard UI with Sonos shortcuts and Home Assistant webhook helpers.
    url: https://github.com/rtimmons/smarthome
    source_dir: grid-dashboard/ExpressServer
    copy:
      - src
      - package.json
      - package-lock.json
      - tsconfig.json
      - prettier.config.js
    container_workdir: /opt/grid-dashboard/app
    npm_build: false
    homeassistant_min: "2024.6.0"
    ingress: true
    ingress_entry: "/"
    panel_icon: "mdi:view-dashboard"
    panel_title: "Grid Dashboard"
    homeassistant_api: true
    auth_api: false
    host_network: false
    ports:
      "3000": 3000
    ports_description:
      "3000": "Optional host port for direct access (ingress is enabled by default)."
    environment:
      NODE_OPTIONS: "--enable-source-maps"
      INGRESS_ENTRY: "/api/hassio_ingress"
    options:
      sonos_base_url: "http://local-sonos-api:5006"
      webhook_base: ""
    schema:
      sonos_base_url: "str?"
      webhook_base: "str?"
    translations:
      configuration:
        sonos_base_url:
          name: Sonos API base URL
          description: Base URL for node-sonos-http-api (e.g., http://node-sonos-http-api:5005).
        webhook_base:
          name: Webhook base URL
          description: Optional override for Home Assistant webhook calls; leave empty to use supervisor proxy.
    docs:
      readme: >
        Local add-on that exposes the Express-based grid dashboard UI with ingress support. Access the dashboard directly
        from the Home Assistant sidebar, or use the Sonos helper routes and convenience redirects.
      docs: >
        This add-on packages the ExpressServer dashboard for Home Assistant, providing easy access to the dashboard UI,
        Sonos controls, and Home Assistant webhook helpers through the Home Assistant interface.
      access: >
        Preferred: use the add-on ingress link from the Home Assistant sidebar. Alternative: access directly via
        http://<ha-host>:3000/ if you need to bypass ingress (port 3000 is exposed by default).
    run_env:
      - env: PORT
        value: "3000"
      - env: APP_PORT
        value: "3000"
      - env: SONOS_BASE_URL
        from_option: sonos_base_url
        default: "http://local-sonos-api:5006"
      - env: HASS_WEBHOOK_BASE
        from_option: webhook_base
        default: ""
        optional: true
    tests:
      - npm test
      - npm run check

  node-sonos-http-api:
    slug: node_sonos_http_api
    name: Node Sonos HTTP API
    description: The actual node-sonos-http-api server for controlling Sonos speakers via HTTP.
    url: https://github.com/jishi/node-sonos-http-api
    source_dir: node-sonos-http-api
    copy:
      - presets
      - presets.example.json
      - patches
    git_clone:
      repo: https://github.com/jishi/node-sonos-http-api.git
      target: /app
    container_workdir: /app
    npm_build: false
    homeassistant_min: "2024.6.0"
    ingress: false
    homeassistant_api: false
    auth_api: false
    host_network: true
    ports:
      "5005": 5005
    ports_description:
      "5005": "Node Sonos HTTP API port"
    environment:
      NODE_OPTIONS: "--enable-source-maps"
    options:
      sonos_discovery_timeout: 5
    schema:
      sonos_discovery_timeout: "int?"
    translations:
      configuration:
        sonos_discovery_timeout:
          name: Sonos discovery timeout
          description: Timeout in seconds for discovering Sonos speakers on the network.
    docs:
      readme: >
        Local add-on that runs the node-sonos-http-api server for controlling Sonos speakers via HTTP API.
      docs: >
        This add-on runs the node-sonos-http-api server, which provides a simple HTTP API for controlling Sonos
        speakers on your network.
      access: >
        The API will be available at http://<ha-host>:5005/ or from other add-ons via http://node-sonos-http-api:5005/.
    run_env:
      - env: PORT
        value: "5005"
      - env: SONOS_DISCOVERY_TIMEOUT
        from_option: sonos_discovery_timeout
        default: "5"
    tests: []

  printer:
    slug: printer_service
    name: Printer Service
    description: Generate and print kitchen labels via Brother/ESC/POS printers or file output.
    url: https://github.com/rtimmons/smarthome
    source_dir: printer
    copy:
      - src
      - pyproject.toml
      - uv.lock
    container_workdir: /opt/printer/app
    python: true
    python_module: printer_service.app
    npm_build: false
    homeassistant_min: "2024.6.0"
    ingress: true
    ingress_entry: "/"
    panel_icon: "mdi:printer"
    panel_title: "Printer"
    homeassistant_api: false
    auth_api: false
    host_network: false
    usb: true
    map:
      - type: share
        read_only: false
    ports:
      "8099": 8099
    ports_description:
      "8099": "Optional host port for direct access (ingress is enabled by default)."
    environment: {}
    options:
      printer_backend: "brother-network"
      brother_uri: "tcp://192.168.1.192:9100"
      brother_model: "QL-810W"
      brother_label: "62x29"
      rotate: "auto"
      high_quality: true
      cut: true
      usb_vendor_id: 4070
      usb_product_id: 33054
      label_output_dir: "/share/printer-labels"
      dev_reload: false
    schema:
      printer_backend: "list(file|brother-network|escpos-usb|escpos-bluetooth)"
      brother_uri: "str?"
      brother_model: "str?"
      brother_label: "str?"
      rotate: "list(auto|0|90|180|270)?"
      high_quality: bool
      cut: bool
      usb_vendor_id: "int?"
      usb_product_id: "int?"
      label_output_dir: "str?"
      dev_reload: bool
    translations:
      configuration:
        printer_backend:
          name: Printer backend
          description: Choose where to send generated labels.
        brother_uri:
          name: Brother printer URI
          description: TCP URI for Brother QL printers (tcp://host:9100).
        brother_model:
          name: Brother model
          description: Model identifier (e.g., QL-810W).
        brother_label:
          name: Label code
          description: Label roll code (e.g., 62x29).
        rotate:
          name: Rotation
          description: Override label rotation before printing.
        high_quality:
          name: High quality
          description: Enable high-quality mode on Brother printers.
        cut:
          name: Auto cut
          description: Trigger a cut after printing on Brother printers.
        usb_vendor_id:
          name: USB vendor ID
          description: Vendor ID for ESC/POS USB printers.
        usb_product_id:
          name: USB product ID
          description: Product ID for ESC/POS USB printers.
        label_output_dir:
          name: Label output directory
          description: Directory where generated labels are stored.
        dev_reload:
          name: Enable dev reload
          description: Restart Flask automatically when files change (development only).
    docs:
      readme: >
        Local add-on that exposes the kitchen label printing Flask UI over Home Assistant ingress. It supports Brother QL network printers, ESC/POS USB or Bluetooth devices, or file-only output that saves generated labels into Home Assistant's /share directory.
      docs: >
        This add-on packages the kitchen label printing service for Home Assistant. The UI is available via ingress, and prints can be dispatched to Brother network printers, ESC/POS USB/Bluetooth devices, or saved as files.
      access: >
        Preferred: use the add-on ingress link from the Home Assistant sidebar (Supervisor → Printer Service → Open Web UI). Optional: map port 8099 to reach it directly via http://<ha-host>:8099/.
    run_env:
      - env: FLASK_HOST
        value: "0.0.0.0"
      - env: FLASK_PORT
        value: "8099"
      - env: LABEL_OUTPUT_DIR
        from_option: label_output_dir
        default: "/share/printer-labels"
      - env: PRINTER_BACKEND
        from_option: printer_backend
        default: "file"
      - env: BROTHER_PRINTER_URI
        from_option: brother_uri
        default: ""
        optional: true
      - env: BROTHER_MODEL
        from_option: brother_model
        default: ""
        optional: true
      - env: BROTHER_LABEL
        from_option: brother_label
        default: ""
        optional: true
      - env: BROTHER_ROTATE
        from_option: rotate
        default: ""
        optional: true
      - env: BROTHER_HQ
        from_option: high_quality
        default: "true"
      - env: BROTHER_CUT
        from_option: cut
        default: "true"
      - env: ESC_POS_VENDOR_ID
        from_option: usb_vendor_id
        default: ""
        optional: true
      - env: ESC_POS_PRODUCT_ID
        from_option: usb_product_id
        default: ""
        optional: true
      - env: PRINTER_DEV_RELOAD
        from_option: dev_reload
        default: "0"
    tests:
      - just test
