addons:
  sonos-api:
    slug: sonos_api
    name: Sonos API
    description: Proxy API for node-sonos-http-api with custom routes and helpers.
    url: https://github.com/rtimmons/smarthome
    source_dir: sonos-api
    copy:
      - src
      - package.json
      - package-lock.json
      - tsconfig.json
    container_workdir: /opt/sonos-api/app
    npm_build: true
    homeassistant_min: "2024.6.0"
    ingress: false
    homeassistant_api: false
    auth_api: false
    host_network: false
    ports:
      "5006": 5006
    ports_description:
      "5006": Sonos API HTTP port
    environment:
      NODE_OPTIONS: "--enable-source-maps"
    options:
      sonos_base_url: "http://local-node-sonos-http-api:5005"
    schema:
      sonos_base_url: "str?"
    translations:
      configuration:
        sonos_base_url:
          name: Sonos API base URL
          description: Base URL for node-sonos-http-api (e.g., http://node-sonos-http-api:5005).
    docs:
      readme: >
        Local add-on that provides a proxy API for node-sonos-http-api with custom routes and helper endpoints
        for controlling Sonos speakers.
      docs: >
        This add-on provides a proxy API for node-sonos-http-api with custom routes and helper endpoints
        tailored for controlling Sonos speakers in your smart home setup.
      access: >
        Access the API at http://<ha-host>:5006/ or use it from other add-ons via http://sonos-api:5006/.
      dependencies:
        - "Requires the Node Sonos HTTP API add-on to be installed and running first."
    run_env:
      - env: PORT
        value: "5006"
      - env: APP_PORT
        value: "5006"
      - env: SONOS_BASE_URL
        from_option: sonos_base_url
        default: "http://local-node-sonos-http-api:5005"
    tests:
      - npm run build

  grid-dashboard:
    slug: grid_dashboard
    name: Grid Dashboard
    description: Dashboard UI with Sonos shortcuts and Home Assistant webhook helpers.
    url: https://github.com/rtimmons/smarthome
    source_dir: grid-dashboard/ExpressServer
    copy:
      - src
      - package.json
      - package-lock.json
      - tsconfig.json
      - prettier.config.js
    container_workdir: /opt/grid-dashboard/app
    npm_build: false
    homeassistant_min: "2024.6.0"
    ingress: true
    ingress_entry: "/"
    panel_icon: "mdi:view-dashboard"
    panel_title: "Grid Dashboard"
    homeassistant_api: true
    auth_api: false
    host_network: false
    ports:
      "3000": 3000
    ports_description:
      "3000": "Optional host port for direct access (ingress is enabled by default)."
    environment:
      NODE_OPTIONS: "--enable-source-maps"
      INGRESS_ENTRY: "/api/hassio_ingress"
    options:
      sonos_base_url: "http://local-sonos-api:5006"
      webhook_base: ""
    schema:
      sonos_base_url: "str?"
      webhook_base: "str?"
    translations:
      configuration:
        sonos_base_url:
          name: Sonos API base URL
          description: Base URL for node-sonos-http-api (e.g., http://node-sonos-http-api:5005).
        webhook_base:
          name: Webhook base URL
          description: Optional override for Home Assistant webhook calls; leave empty to use supervisor proxy.
    docs:
      readme: >
        Local add-on that exposes the Express-based grid dashboard UI with ingress support. Access the dashboard directly
        from the Home Assistant sidebar, or use the Sonos helper routes and convenience redirects.
      docs: >
        This add-on packages the ExpressServer dashboard for Home Assistant, providing easy access to the dashboard UI,
        Sonos controls, and Home Assistant webhook helpers through the Home Assistant interface.
      access: >
        Preferred: use the add-on ingress link from the Home Assistant sidebar. Alternative: access directly via
        http://<ha-host>:3000/ if you need to bypass ingress (port 3000 is exposed by default).
    run_env:
      - env: PORT
        value: "3000"
      - env: APP_PORT
        value: "3000"
      - env: SONOS_BASE_URL
        from_option: sonos_base_url
        default: "http://local-sonos-api:5006"
      - env: HASS_WEBHOOK_BASE
        from_option: webhook_base
        default: ""
        optional: true
    tests:
      - npm test
      - npm run check

  node-sonos-http-api:
    slug: node_sonos_http_api
    name: Node Sonos HTTP API
    description: The actual node-sonos-http-api server for controlling Sonos speakers via HTTP.
    url: https://github.com/jishi/node-sonos-http-api
    source_dir: node-sonos-http-api
    copy: []
    git_clone:
      repo: https://github.com/jishi/node-sonos-http-api.git
      target: /app
    container_workdir: /app
    npm_build: false
    homeassistant_min: "2024.6.0"
    ingress: false
    homeassistant_api: false
    auth_api: false
    host_network: true
    ports:
      "5005": 5005
    ports_description:
      "5005": "Node Sonos HTTP API port"
    environment:
      NODE_OPTIONS: "--enable-source-maps"
    options:
      sonos_discovery_timeout: 5
    schema:
      sonos_discovery_timeout: "int?"
    translations:
      configuration:
        sonos_discovery_timeout:
          name: Sonos discovery timeout
          description: Timeout in seconds for discovering Sonos speakers on the network.
    docs:
      readme: >
        Local add-on that runs the node-sonos-http-api server for controlling Sonos speakers via HTTP API.
      docs: >
        This add-on runs the node-sonos-http-api server, which provides a simple HTTP API for controlling Sonos
        speakers on your network.
      access: >
        The API will be available at http://<ha-host>:5005/ or from other add-ons via http://node-sonos-http-api:5005/.
    run_env:
      - env: PORT
        value: "5005"
      - env: SONOS_DISCOVERY_TIMEOUT
        from_option: sonos_discovery_timeout
        default: "5"
    tests: []
